# 部署到阿里云服务器

## 服务器信息
- **IP**: 182.92.59.70
- **用户**: root
- **密码**: ryg@893012
- **端口分配**: 
  - 前端: 3004
  - 后端API: 3002

## 快速部署步骤

### 第一步：本地打包

```bash
cd /Users/liudong/Desktop/myGitProgect/wladmin
npm run build
```

### 第二步：连接服务器

```bash
ssh root@182.92.59.70
# 密码: ryg@893012
```

### 第三步：在服务器上准备环境

```bash
# 1. 安装Node.js（如果未安装）
curl -fsSL https://rpm.nodesource.com/setup_18.x | bash -
yum install -y nodejs

# 2. 安装PM2和serve
npm install -g pm2 serve

# 3. 安装MongoDB（如果未安装）
# 使用Docker方式（推荐）
docker run -d --name mongodb -p 27017:27017 --restart=always mongo:latest

# 或使用yum安装
bash deploy/install-mongodb.sh

# 4. 创建部署目录
mkdir -p /opt/wladmin/{frontend,backend,logs}
```

### 第四步：上传文件（在本地执行）

打开新的终端窗口，在本地执行：

```bash
# 上传前端文件
scp -r dist/* root@182.92.59.70:/opt/wladmin/frontend/

# 上传后端文件
scp -r server/* root@182.92.59.70:/opt/wladmin/backend/

# 上传PM2配置
scp deploy/ecosystem.config.js root@182.92.59.70:/opt/wladmin/
```

### 第五步：在服务器上启动服务

回到服务器SSH会话：

```bash
# 安装后端依赖
cd /opt/wladmin/backend
npm install --production

# 启动服务
cd /opt/wladmin
pm2 start ecosystem.config.js

# 保存PM2配置
pm2 save

# 设置开机自启（执行输出的命令）
pm2 startup
```

### 第六步：配置防火墙

```bash
# 开放端口
firewall-cmd --permanent --add-port=3004/tcp
firewall-cmd --permanent --add-port=3002/tcp
firewall-cmd --reload
```

### 第七步：配置阿里云安全组

1. 登录阿里云控制台
2. 进入 ECS -> 安全组
3. 添加入站规则：
   - 端口3004，协议TCP，授权对象0.0.0.0/0
   - 端口3002，协议TCP，授权对象0.0.0.0/0

## 访问地址

- **前端**: http://182.92.59.70:3004
- **后端API**: http://182.92.59.70:3002

## 管理命令

```bash
# 查看服务状态
pm2 list

# 查看日志
pm2 logs

# 重启服务
pm2 restart all

# 停止服务
pm2 stop all
```

## 更新部署

```bash
# 1. 本地重新打包
npm run build

# 2. 上传新文件
scp -r dist/* root@182.92.59.70:/opt/wladmin/frontend/
scp -r server/* root@182.92.59.70:/opt/wladmin/backend/

# 3. 服务器上重启
ssh root@182.92.59.70 'cd /opt/wladmin/backend && npm install --production && pm2 restart all'
```

## 注意事项

1. ✅ 端口3004和3002不会影响其他服务
2. ✅ 所有文件在 `/opt/wladmin` 目录
3. ✅ 使用PM2管理，支持自动重启
4. ✅ 确保MongoDB运行在27017端口
